<project default="all" >

    <property name="sourceRepository" value="https://github.com/Wanderer19/First.git" />
    <property name="projectDirectory" value="First"/>
    <property name="branchName" value="newBranch"/>
    <property name="sources" value="sources"/>
    <property name="maven.home" value="C:\Program Files\Appache\apache-maven-3.2.5"/>
    <property name="maven.options" value="-DskipTests=true --update-snapshots"/>
    <property name="archives" value="archives"/>
    <property name="localRepository" value="C:\Users\wanderer\Desktop\repo"/>
    <property name="git-location" value="C:\Program Files (x86)\Git\bin\git.exe"/>


    <target name="all">
        <antcall target="clean-all"/>
        <antcall target="creating"/>
        <antcall target="git-cloning"/>
        <antcall target="zip-sources"/>
        <antcall target="building"/>
        <antcall target="zip-modules-and-libs"/>
        <antcall target="delete-sources-and-local-repo"/>
    </target>

    <target name="clean-all">
        <delete dir="${sources}"/>
        <delete dir="${archives}"/>
        <delete dir="${localRepository}"/>
    </target>

    <target name="creating">
        <mkdir dir="${sources}"/>
        <mkdir dir="${archives}"/>
        <mkdir dir="${localRepository}"/>
    </target>

    <target name="git-cloning">
        <exec executable="cmd">
            <arg value="/c"/>
            <arg value="git-cloning.bat"/>
            <arg value="${sources}"/>
            <arg value="${git-location}"/>
            <arg value="${branchName}"/>
            <arg value="${sourceRepository}"/>
            <arg value="-p"/>
        </exec>
    </target>

    <target name="zip-sources">
        <zip destfile="${archives}/sources.zip"  basedir="${sources}"
             update="true"/>
    </target>

    <macrodef name="maven">
        <attribute name="options" default="" />
        <attribute name="goal" />
        <attribute name="basedir" />
        <attribute name="resultproperty" default="maven.result" />
        <element name="args" implicit="true" optional="true" />
        <sequential>
            <java classname="org.codehaus.classworlds.Launcher" fork="true"
                  dir="@{basedir}" resultproperty="@{resultproperty}">
                <jvmarg value="-Xmx512m"/>
                <classpath>
                    <fileset dir="${maven.home}/boot">
                        <include name="*.jar" />
                    </fileset>
                    <fileset dir="${maven.home}/lib">
                        <include name="*.jar" />
                    </fileset>
                </classpath>
                <sysproperty key="classworlds.conf" value="${maven.home}/bin/m2.conf" />
                <sysproperty key="maven.home" value="${maven.home}" />
                <arg line="--batch-mode -Dmaven.repo.local=${localRepository} @{options} @{goal}" />
            </java>
        </sequential>
    </macrodef>

    <target name="building">
        <maven basedir="${sources}/${projectDirectory}"
               goal="clean install"
               options="${maven.options}"
               resultproperty="maven.build.result"/>
    </target>

    <target name="zip-modules-and-libs">

        <zip destfile="${archives}/modules.zip"  basedir="${sources}/${projectDirectory}/target"
             includes="*.jar, *.war, *.ear"
             update="true"/>

        <zip destfile="${archives}/libs.zip"  basedir="${localRepository}"
             update="true"/>
    </target>

    <target name="delete-sources-and-local-repo">
        <delete dir="${sources}"/>
        <delete dir="${localRepository}"/>
    </target>

</project>